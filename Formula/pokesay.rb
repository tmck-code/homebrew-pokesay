class Pokesay < Formula
  desc "Print pokemon in the CLI! An adaptation of the classic 'cowsay'"
  homepage "https://github.com/tmck-code/pokesay"
  url "https://github.com/tmck-code/pokesay/releases/download/v0.18.2/pokesay-0.18.2.tar.gz"
  license "BSD-3-Clause"
  sha256 "fa8ce4ce21d0cf4a2ce8a3e664088c222feefed6fab39738f78b6845f996d123"

  def install
    if OS.mac? && Hardware::CPU.intel?      then binfile = "pokesay-0.18.2-darwin-amd64"
    elsif OS.mac? && Hardware::CPU.arm?     then binfile = "pokesay-0.18.2-darwin-arm64"
    elsif OS.linux? && Hardware::CPU.intel? then binfile = "pokesay-0.18.2-linux-amd64"
    end

    bin.install binfile => "pokesay"

    # TODO: figure out this nightmare
    # bash_completion.install "pokesay-completion.bash" => "pokesay"
    # fish_completion.install "pokesay-completion.fish" => "pokesay.fish"
    # zsh_completion.install "pokesay-completion.zsh" => "_pokesay"
    # share.install "pokesay-names.txt"
    # share.install "pokesay-ids.txt"

    man1.install "pokesay.1"
  end

  test do
    expected_output = <<~EOF
      â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      â”‚ w[0m                    â”‚
      â•°â”€â”€â”€â”€â”€â”€â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
              â•²
               â•²
                â•²
                 â•²
                      [38;5;16m[49mâ–„â–„[38;5;245m[48;5;16mâ–„[38;5;231m[48;5;16mâ–„[38;5;245m[48;5;16mâ–„[38;5;16m[49mâ–„â–„[49m         [0m
           [38;5;16m[49mâ–„[38;5;172m[48;5;16mâ–„[38;5;214m[48;5;16mâ–„[38;5;16m[49mâ–„     â–„[38;5;167m[48;5;16mâ–„[38;5;131m[48;5;167m  â–„[38;5;231m[48;5;245mâ–„[38;5;151m[48;5;231m â–„[38;5;77m[48;5;231mâ–„[38;5;77m[48;5;16mâ–„[38;5;16m[49mâ–„       [0m
          [38;5;172m[49m[38;5;172m[48;5;16m [38;5;172m[48;5;172m   [38;5;172m[48;5;214mâ–„[38;5;214m[48;5;16mâ–„[38;5;16m[49mâ–„[38;5;131m[49m   [38;5;131m[48;5;16m [38;5;131m[48;5;167mâ–„[38;5;77m[48;5;167m [38;5;77m[48;5;131m [38;5;77m[48;5;231m  â–„  â–„[38;5;16m[48;5;16m [38;5;16m[49m       [0m
           [38;5;16m[49mâ–€[38;5;16m[48;5;172mâ–„[38;5;238m[48;5;172m   â–„[38;5;238m[48;5;16mâ–„â–„â–„[38;5;214m[48;5;16mâ–„[38;5;238m[48;5;131mâ–„[38;5;231m[48;5;131m  [38;5;231m[48;5;231m  [38;5;231m[48;5;151mâ–„[38;5;231m[48;5;77mâ–„[38;5;131m[48;5;77mâ–„[38;5;131m[48;5;151mâ–„[38;5;167m[48;5;238mâ–„[38;5;167m[48;5;16mâ–„[38;5;16m[49mâ–„[38;5;172m[49m     [0m
             [38;5;16m[49mâ–€[38;5;16m[48;5;172mâ–„[38;5;172m[48;5;172m  [38;5;172m[48;5;238mâ–„[38;5;16m[48;5;238mâ–„[38;5;16m[48;5;214mâ–„[38;5;131m[48;5;214mâ–„[38;5;214m[48;5;214m [38;5;214m[48;5;238mâ–„â–„[38;5;172m[48;5;238mâ–„[38;5;238m[48;5;167mâ–„â–„â–„[38;5;16m[48;5;167m   â–„â–„[38;5;16m[49mâ–€    [0m
             [38;5;16m[49m[38;5;16m[48;5;16m [38;5;16m[48;5;172m  â–„[38;5;16m[49mâ–€â–„[38;5;214m[48;5;16mâ–„[38;5;238m[48;5;214m   [38;5;238m[48;5;16mâ–„[38;5;16m[48;5;231mâ–„[38;5;214m[48;5;172mâ–„[38;5;214m[48;5;214m [38;5;214m[48;5;172mâ–„[38;5;172m[48;5;238mâ–„â–„[38;5;16m[48;5;16m [38;5;16m[49m       [0m
              [38;5;16m[49mâ–€[38;5;16m[48;5;172mâ–„[38;5;131m[48;5;172mâ–„[38;5;238m[48;5;16mâ–„[38;5;130m[48;5;214mâ–„[38;5;172m[48;5;214m   [38;5;172m[48;5;203m  [38;5;172m[48;5;214m   â–„[38;5;238m[48;5;214mâ–„[38;5;172m[48;5;16mâ–„[38;5;16m[49mâ–„       [0m
              [38;5;16m[49mâ–€[38;5;16m[48;5;131mâ–„[38;5;130m[48;5;238m [38;5;130m[48;5;214mâ–„[38;5;238m[48;5;214m  â–„[38;5;214m[48;5;214m [38;5;214m[48;5;238mâ–„[38;5;238m[48;5;214mâ–„[38;5;172m[48;5;214mâ–„[38;5;16m[48;5;172m â–„[38;5;16m[49mâ–€â–€â–€        [0m
                [38;5;238m[49m[38;5;238m[48;5;16m [38;5;238m[48;5;214mâ–„[38;5;214m[48;5;214m   [38;5;214m[48;5;238mâ–„â–„[38;5;16m[48;5;172m  â–„[38;5;16m[49mâ–€           [0m
                 [38;5;16m[49mâ–€[38;5;16m[48;5;214mâ–„ â–„â–„[38;5;16m[49mâ–€â–€â–€[38;5;238m[49m             [0m
                   [39m[49m[38;5;16m[49mâ–€                  [0m
                                      [0m
      â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
      â”‚ â†’ Pikachu â”‚ ãƒ”ã‚«ãƒãƒ¥ã‚¦ (pikachuu) â”‚ 0580.4582 â”‚
      â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
    EOF
    assert_equal expected_output.strip, shell_output("echo w | #{bin}/pokesay -ubjICF -w20 -i 0580.4582").strip
  end
end
